"""
é’¢è¹¦é˜…è¯»_V1.8   

å…¥å£ å¾®ä¿¡æ‰“å¼€ï¼šhttp://2650317.vofr83a63b.dyybgj.jqlwhewapph9h.cloud/page?p=2650317  (é“¾æ¥å¯èƒ½è¢«åŠ«æŒï¼Œè¯·å¤šè¯•å‡ æ¬¡)

å»ºè®®å°†é“¾æ¥æ·»åŠ è‡³å¾®ä¿¡æ”¶è—ï¼Œæ–¹ä¾¿è¿›å…¥æŸ¥çœ‹

æç¤ºï¼šæ£€æµ‹æ–‡ç« ä¸è¿‡ï¼Œæœ‰é»‘å·çš„é£é™©ï¼Œå¦‚ä¸èƒ½åŠæ—¶æ¥æ”¶æ£€æµ‹æ–‡ç« æ¨é€ï¼Œæˆ–ä¸èƒ½èƒ½åŠæ—¶é˜…è¯»æ£€æµ‹æ–‡ç« ï¼Œå»ºè®®æ‰‹åŠ¨è¿è¡Œè„šæœ¬ï¼Œè¿è¡Œå‰å»å¾®ä¿¡æ‰‹åŠ¨é˜…è¯»ä¸‰ç¯‡æ–‡ç« ï¼Œæ¯ç¯‡é˜…è¯»6ç§’ä»¥ä¸Šã€‚
      æ¯å¤©180ä¸ªä»»åŠ¡ä¸å»ºè®®è·‘æ»¡ï¼Œç»†æ°´é•¿æµï¼Œå¦‚å‡ºç°é˜…è¯»æ›´æ–°ä¸­ï¼Œä½ çš„è´¦å·å¯èƒ½é£é™©ï¼Œå»ºè®®24å°æ—¶åå†æ“ä½œï¼Œå¹³æ—¶ä»è®¢é˜…å·å¤šè¯»è¯»æ–‡ç« ï¼Œå¯ä»¥å‡å°é»‘å·çš„å‡ ç‡

8/18_update ä¿®å¤bug
8/22_update  å¢åŠ æ¨é€æ£€æµ‹æ–‡ç«    å°†å¤šä¸ªè´¦å·æ£€æµ‹æ–‡ç« æ¨é€è‡³ç›®æ ‡å¾®ä¿¡ï¼Œæ‰‹åŠ¨ç‚¹å‡»é“¾æ¥å®Œæˆæ£€æµ‹é˜…è¯»
8/29_update  æ›´æ–°æ£€æµ‹æ–‡ç« é€»è¾‘ ä¼˜åŒ–æ—¥å¿—
9/4_update   ä¿®å¤bugï¼Œæ—¥å¿—æ·»åŠ Emojiï¼ŒæŸ¥çœ‹æ›´ç›´è§‚
9/8_update   æ”¯æŒpushplus+æ¨é€ï¼Œå¢åŠ å¹¶å‘(ç¼©çŸ­è¿è¡Œæ—¶é—´)
9/14_update   ä¿®å¤bugï¼Œå¢åŠ ç¨³å®šæ€§

@ä»…ä¾›å­¦ä¹ äº¤æµï¼Œè¯·åœ¨ä¸‹è½½åçš„24å°æ—¶å†…å®Œå…¨åˆ é™¤ è¯·å‹¿å°†ä»»ä½•å†…å®¹ç”¨äºå•†ä¸šæˆ–éæ³•ç›®çš„ï¼Œå¦åˆ™åæœè‡ªè´Ÿã€‚

@å»ºè®®ä¸€ä¸ªå¾®ä¿¡å·åªè¿è¡Œä¸€ä¸ªé˜…è¯»ä»»åŠ¡ï¼Œå¦åˆ™æå…¶å®¹æ˜“é»‘å·

é˜…è¯»æ–‡ç« æŠ“å‡ºcookieï¼ˆæ‰¾ä¸åˆ°æœç´¢gfsessionidå…³é”®è¯ï¼‰ å»ºè®®æ‰‹åŠ¨é˜…è¯»5ç¯‡å·¦å³å†ä½¿ç”¨è„šæœ¬ï¼Œä¸ç„¶100%é»‘ï¼ï¼ï¼
keyä¸ºä¼ä¸šå¾®ä¿¡webhookæœºå™¨äººåé¢çš„ key  ï¼Œä¹Ÿå¯ä»¥å¡«å†™pushpluså£ä»¤   å¦‚ï¼šff2cdxxxxxxxx
å˜é‡åç§°ï¼šydtoken     å˜é‡å€¼ï¼šgfsessionid=o-0fIv9cGv3xxxxxxx
å¤šè´¦å·ç”¨'@'éš”å¼€ ä¾‹ è´¦å·1@è´¦å·2

å®šæ—¶:
è‡ªåŠ¨å®šæ—¶è§„åˆ™cronï¼š0 7-23/3 * * *   (æ¯å¤©7-23ç‚¹æ¯3å°æ—¶ä¸€æ¬¡)
æ‰‹åŠ¨å®šæ—¶è§„åˆ™cronï¼š0 0 1 1 *    (æ¯å¹´1æœˆ1æ—¥0ç‚¹1æ¬¡)
"""

max_concurrency = 0  # å¹¶å‘çº¿ç¨‹æ•°
money_Withdrawal = 0  # æç°å¼€å…³ 1å¼€å¯ 0å…³é—­
key = ""        #keyä¸ºä¼ä¸šå¾®ä¿¡webhookæœºå™¨äººåé¢çš„ keyï¼Œæˆ–pushpluså£ä»¤ï¼ŒäºŒé€‰ä¸€





import re
import hashlib
import json
import os
import random

import threading
import time
from multiprocessing import Pool
from multiprocessing.pool import ThreadPool
import requests

lock = threading.Lock()


def process_account(account, i):
    values = account.split('@')
    cookie = values[0]

    print(f"\n=======ğŸ’šå¼€å§‹æ‰§è¡Œè´¦å·{i}ğŸ’š=======")
    current_time = str(int(time.time()))

    sign_str = f'key=4fck9x4dqa6linkman3ho9b1quarto49x0yp706qi5185o&time={current_time}'
    sha256_hash = hashlib.sha256(sign_str.encode())
    sign = sha256_hash.hexdigest()
    url = "http://2477726.neavbkz.jweiyshi.r0ffky3twj.cloud/share"
    headers = {
        "User-Agent": "Mozilla/5.0 (Linux; Android 9; V1923A Build/PQ3B.190801.06161913; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/91.0.4470.114 Safari/537.36 MMWEBID/5635 MicroMessenger/8.0.40.2420(0x28002837) WeChat/arm64 Weixin Android Tablet NetType/WIFI Language/zh_CN ABI/arm64",
        "Cookie": cookie
    }

    data = {
        "time": current_time,
        "sign": sign
    }

    with lock:
        response = requests.get(url, headers=headers, json=data).json()
        share_link = response['data']['share_link'][0]
        p_value = share_link.split('=')[1].split('&')[0]

        url = "http://2477726.neavbkz.jweiyshi.r0ffky3twj.cloud/read/info"

        response = requests.get(url, headers=headers, json=data).json()

        if response['code'] == 0:
            remain = response['data']['remain']
            read = response['data']['read']
            print(f"ID:{p_value}-----ğŸ’°é’¢é•šä½™é¢:{remain}\nğŸ“–ä»Šæ—¥é˜…è¯»é‡::{read}")
        else:
            print(response['message'])

    print("============ğŸ’šå¼€å§‹æ‰§è¡Œé˜…è¯»æ–‡ç« ğŸ’š============")

    for j in range(30):
        biz_list = ['MzkyMzI5NjgxMA==', 'MzkzMzI5NjQ3MA==', 'Mzg5NTU4MzEyNQ==', 'Mzg3NzY5Nzg0NQ==',
                    'MzU5OTgxNjg1Mg==', 'Mzg4OTY5Njg4Mw==', 'MzI1ODcwNTgzNA==','Mzg2NDY5NzU0Mw==']
        # è®¡ç®— sign
        sign_str = f'key=4fck9x4dqa6linkman3ho9b1quarto49x0yp706qi5185o&time={current_time}'
        sha256_hash = hashlib.sha256(sign_str.encode())
        sign = sha256_hash.hexdigest()
        url = "http://2477726.9o.10r8cvn6b1.cloud/read/task"

        try:
            response = requests.get(url, headers=headers, json=data, timeout=7).json()
        except requests.Timeout:
            print("â—è¯·æ±‚è¶…æ—¶ï¼Œå°è¯•é‡æ–°å‘é€è¯·æ±‚...")
            response = requests.get(url, headers=headers, json=data, timeout=7).json()
        if response['code'] == 1:
            print(response['message'])
            break
        else:
            try:
                mid = response['data']['link'].split('&mid=')[1].split('&')[0]
                biz = response['data']['link'].split('__biz=')[1].split('&')[0]

                print(f"[{p_value}]è·å–æ–‡ç« æˆåŠŸ---{mid} æ¥æº[{biz}]")

                if biz in biz_list:
                    print(f"å‘ç°ç›®æ ‡[{biz}] ç–‘ä¼¼æ£€æµ‹æ–‡ç« ï¼ï¼ï¼")
                    link = response['data']['link']
                    url = 'https://qyapi.weixin.qq.com/cgi-bin/webhook/send?key=' + key

                    messages = [
                        f"å‡ºç°æ£€æµ‹æ–‡ç« ï¼ï¼ï¼\n{link}\nè¯·åœ¨60så†…ç‚¹å‡»é“¾æ¥å®Œæˆé˜…è¯»",
                    ]

                    for message in messages:
                        data = {
                            "msgtype": "text",
                            "text": {
                                "content": message
                            }
                        }
                        headers = {'Content-Type': 'application/json'}
                        response = requests.post(url, headers=headers, data=json.dumps(data))

                        url = 'http://www.pushplus.plus/send'
                        data = {
                             "token": key,
                             "title": "å‡ºç°æ£€æµ‹æ–‡ç« ï¼è¯·åœ¨60så†…å®Œæˆé˜…è¯»",
                             "content": f'<a href="\n{link}\n"target="_blank">ç‚¹å‡»é˜…è¯»6sä»¥ä¸Š',  
                             "template": "html"
                        }
                        response = requests.post(url, data=data).json()                                                   
                        
                        print("å·²å°†è¯¥æ–‡ç« æ¨é€è‡³å¾®ä¿¡è¯·åœ¨60så†…ç‚¹å‡»é“¾æ¥å®Œæˆé˜…è¯»--60såç»§ç»­è¿è¡Œ")
                        time.sleep(60)
                        url = "http://2477726.9o.10r8cvn6b1.cloud/read/finish"
                        headers = {
                            "User-Agent": "Mozilla/5.0 (Linux; Android 9; V1923A Build/PQ3B.190801.06161913; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/91.0.4470.114 Safari/537.36 MMWEBID/5635 MicroMessenger/8.0.40.2420(0x28002837) WeChat/arm64 Weixin Android Tablet NetType/WIFI Language/zh_CN ABI/arm64",
                            "Cookie": cookie
                        }
                        data = {
                            "time": current_time,
                            "sign": sign
                        }
                        try:
                            response = requests.get(url, headers=headers, data=data, timeout=7).json()
                        except requests.Timeout:
                            print("â—è¯·æ±‚è¶…æ—¶ï¼Œå°è¯•é‡æ–°å‘é€è¯·æ±‚...")
                            response = requests.get(url, headers=headers, data=data, timeout=7).json()
                        if response['code'] == 0:
                            gain = response['data']['gain']
                            print(f"ç¬¬{j + 1}æ¬¡é˜…è¯»æ£€æµ‹æ–‡ç« æˆåŠŸ---è·å¾—é’¢é•š[{gain}]")
                            print(f"--------------------------------")
                        else:
                            print(f"â—è¿‡æ£€æµ‹å¤±è´¥ï¼Œè¯·å°è¯•é‡æ–°è¿è¡Œ")
                            break
                else:
                    sleep = random.randint(8, 15)
                    print(f"æœ¬æ¬¡æ¨¡æ‹Ÿé˜…è¯»{sleep}ç§’")
                    time.sleep(sleep)
                    url = "http://2477726.9o.10r8cvn6b1.cloud/read/finish"
                    headers = {
                        "User-Agent": "Mozilla/5.0 (Linux; Android 9; V1923A Build/PQ3B.190801.06161913; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/91.0.4470.114 Safari/537.36 MMWEBID/5635 MicroMessenger/8.0.40.2420(0x28002837) WeChat/arm64 Weixin Android Tablet NetType/WIFI Language/zh_CN ABI/arm64",
                        "Cookie": cookie
                    }
                    data = {
                        "time": current_time,
                        "sign": sign
                    }
                    try:
                        response = requests.get(url, headers=headers, data=data, timeout=7).json()
                    except requests.Timeout:
                        print("â—è¯·æ±‚è¶…æ—¶ï¼Œå°è¯•é‡æ–°å‘é€è¯·æ±‚...")
                        response = requests.get(url, headers=headers, data=data, timeout=7).json()
                    if response['code'] == 0:
                        gain = response['data']['gain']
                        print(f"ç¬¬{j + 1}æ¬¡é˜…è¯»æ–‡ç« æˆåŠŸ---è·å¾—é’¢é•š[{gain}]")
                        print(f"--------------------------------")
                    else:
                        print(f"â—é˜…è¯»æ–‡ç« å¤±è´¥{response}")
                        break
            except KeyError:
                print(f"â—è·å–æ–‡ç« å¤±è´¥,é”™è¯¯æœªçŸ¥{response}")
                break
    if money_Withdrawal == 1:
        print(f"============ğŸ’°å¼€å§‹å¾®ä¿¡æç°ğŸ’°============")
        url = "http://2477726.84.8agakd6cqn.cloud/withdraw/wechat"

        response = requests.get(url, headers=headers, json=data).json()
        if response['code'] == 0:
            print(response['message'])
        elif response['code'] == 1:
            print(response['message'])
        else:
            print(f"é”™è¯¯æœªçŸ¥{response}")
    elif money_Withdrawal == 0:
        print(f"{'-' * 30}\nä¸æ‰§è¡Œæç°")


if __name__ == "__main__":
    accounts = os.getenv('ydtoken')
    if accounts is None:
        print('è¯·æ£€æŸ¥ä½ çš„ydtokenï¼Œæ˜¯å¦å¡«å†™æ­£ç¡®')
    else:
        response = requests.get('https://netcut.cn/p/e9a1ac26ab3e543b')
        note_content_list = re.findall(r'"note_content":"(.*?)"', response.text)
        formatted_note_content_list = [note.replace('\\n', '\n').replace('\\/', '/') for note in note_content_list]
        for note in formatted_note_content_list:
            print(note)
        accounts_list = os.environ.get('ydtoken').split('@')
        num_of_accounts = len(accounts_list)
        print(f"è·å–åˆ° {num_of_accounts} ä¸ªè´¦å·")
        with Pool(processes=num_of_accounts) as pool:
            thread_pool = ThreadPool(max_concurrency)
            thread_pool.starmap(process_account, [(account, i) for i, account in enumerate(accounts_list, start=1)])
